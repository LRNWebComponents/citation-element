<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../hax-body-behaviors/hax-body-behaviors.html">
<link rel="import" href="../schema-behaviors/schema-behaviors.html">
<!--
`citation-element`
A LRN element

@demo demo/index.html

@microcopy - the mental model for this element
 -
 -

-->

<dom-module id="citation-element">
  <template>
    <style>
      :host {
        display: block;
        color: var('--license-text-color');
      }
      :host[display-method="footnote"] {
        visibility: hidden;
        opacity: 0;
      }
      :host[display-method="popup"] {
        display: block;
      }
      .license-link {
        font-size: 1em;
        line-height: 1em;
        font-style: italic;
      }
      .citation-date {
        font-size: 1em;
        line-height: 1em;
        font-style: italic;
      }
      .license-link img {
        height: 1em;
        min-width: 1em;
        margin-right: .5em;
      }
    </style>
    <link typeof="resource" src="[[source]]"/>
    <cite>[[title]] by [[creator]], licensed under <a class="license-link" target="_blank" href="[[licenseLink]]"><img src="[[licenseImage]] hidden&="[[!licenseImage]]" />[[licenseName]]</a>. Accessed <span class="citation-date">[[date]]</span>.</cite>
  </template>

  <script>
    Polymer({
      is: 'citation-element',
      behaviors: [
        HAXBehaviors.PropertiesBehaviors,
        SchemaBehaviors.Schema
      ],
      properties: {
        /**
         * Title of the work.
         */
        title: {
          type: String,
        },
        /**
         * How to present the citation on the interface.
         * Can be popup, footnote, or default behavior which is visible
         */
        displayMethod: {
          type: String,
          reflectToAttribute: true,
        },
        /**
         * Person or group that owns / created the work.
         */
        creator: {
          type: String,
        },
        /**
         * Original Source of the work in question
         */
        source: {
          type: String,
        },
        /**
         * Date the work was accessed.
         */
        date: {
          type: String,
        },
        /**
         * License name, calculated or supplied by the end user if we don't have them.
         */
        licenseName: {
          type: String,
        },
        /**
         * License link for more details
         */
        licenseLink: {
          type: String,
        },
        /**
         * License short hand. Options cc0,
         */
        license: {
          type: String,
          observer: '_licenseUpdated',
        },
      },
      /**
       * Attached to the DOM, now fire.
       */
      attached: function() {
        // Establish hax property binding
        let props = {
          'canScale': false,
          'canPosition': false,
          'canEditSource': false,
          'gizmo': {
            'title': 'Citation',
            'description': 'A basic citation element with 3 presentation modes',
            'icon': 'editor:title',
            'color': 'grey',
            'groups': ['Content', 'Text', 'Copyright'],
            'handles': [
              {
                'type': 'citation',
                'source': 'source',
                'title': 'title',
                'author': 'creator',
                'license': 'license',
                'accessDate': 'date'
              }
            ],
            'meta': {
              'author': 'LRNWebComponents'
            }
          },
          'settings': {
            'quick': [
              {
                'property': 'title',
                'title': 'Title',
                'description': 'The title of the work being cited.',
                'inputMethod': 'textfield',
                'icon': 'editor:title',
              },
              {
                'property': 'source',
                'title': 'Source',
                'description': 'The source url for the element this is citing.',
                'inputMethod': 'textfield',
                'icon': 'link',
              },
              {
                'property': 'date',
                'title': 'Date accessed',
                'description': 'The date this was accessed.',
                'inputMethod': 'textfield',
                'icon': 'link',
              },
              {
                'property': 'license',
                'title': 'License',
                'description': 'The source url for the element this is citing.',
                'inputMethod': 'select',
                'options': this.licenseList(),
                'icon': 'link',
              },
              {
                'property': 'creator',
                'title': 'Creator',
                'description': 'Who made or owns this.',
                'inputMethod': 'textfield',
                'icon': 'link',
              },
            ],
            'configure': [
              {
                'property': 'title',
                'title': 'Title',
                'description': 'The title of the work being cited.',
                'inputMethod': 'textfield',
                'icon': 'editor:title',
              },
              {
                'property': 'source',
                'title': 'Source',
                'description': 'The source url for the element this is citing.',
                'inputMethod': 'textfield',
                'icon': 'link',
              },
              {
                'property': 'date',
                'title': 'Date accessed',
                'description': 'The date this was accessed.',
                'inputMethod': 'textfield',
                'icon': 'link',
              },
              {
                'property': 'license',
                'title': 'License',
                'description': 'The source url for the element this is citing.',
                'inputMethod': 'select',
                'options': this.licenseList(),
                'icon': 'link',
              },
              {
                'property': 'creator',
                'title': 'Creator',
                'description': 'Who made or owns this.',
                'inputMethod': 'textfield',
                'icon': 'link',
              },
              {
                'property': 'displayMethod',
                'title': 'Display method',
                'description': 'Who made or owns this.',
                'inputMethod': 'textfield',
                'icon': 'link',
              },
            ],
            'advanced': [
            ]
          }
        };
        this.setHaxProperties(props);
      },
      /**
       * A list of licenses that we support the references for.
       */
      licenseList: function() {
        let list = {
          'by': {
            'name': 'Attribution',
            'link': 'https://creativecommons.org/',
            'image': '',
          },
          'by-sa': {
            'name': 'Attribution Share a like',
            'link': 'https://creativecommons.org/',
            'image': '',
          },
          'by-nd': {
            'name': 'Attribution No derivatives',
            'link': 'https://creativecommons.org/',
            'image': '',
          },
          'by-nc': {
            'name': 'Attribution non-commercial',
            'link': 'https://creativecommons.org/',
            'image': '',
          },
          'by-nc-sa': {
            'name': 'Attribution non-commercial share a like',
            'link': 'https://creativecommons.org/',
            'image': '',
          },
          'by-nc-nd': {
            'name': 'Attribution Non-commercial No derivatives',
            'link': 'https://creativecommons.org/',
            'image': '',
          },
          'cc0': {
            'name': 'Public domain',
            'link': 'https://creativecommons.org/',
            'image': '',
          },
        };
        return list;
      },
      /**
       * License was updated, time to update license name and link.
       */
      _licenseUpdated: function(newValue, oldValue) {
        if (typeof newValue !== typeof undefined) {
          var list = this.licenseList();
          if (typeof list[newValue] !== typeof undefined) {
            this.licenseName = list[newValue].name;
            this.licenseLink = list[newValue].link;
            this.licenseImage = list[newValue].image;
          }
        }
      }
    });
  </script>
</dom-module>
